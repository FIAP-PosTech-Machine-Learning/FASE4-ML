from flask import Flask, request, jsonify
import numpy as np
import pandas as pd
from keras.models import load_model

app = Flask(__name__)

# Carregar o modelo LSTM treinado
model = load_model('../models/lstm_model.h5')

@app.route('/predict', methods=['POST'])
def predict():
    data = request.get_json(force=True)
    
    # Verificar se os dados foram fornecidos
    if 'data' not in data:
        return jsonify({'error': 'Dados não fornecidos'}), 400
    
    # Converter os dados recebidos em um DataFrame
    input_data = pd.DataFrame(data['data'])
    
    # Pré-processamento dos dados (normalização, reshape, etc.)
    # Aqui você deve incluir o mesmo pré-processamento que foi feito durante o treinamento do modelo
    # Exemplo: input_data = (input_data - mean) / std
    # input_data = input_data.values.reshape((1, input_data.shape[0], input_data.shape[1]))

    # Fazer a previsão
    prediction = model.predict(input_data)
    
    # Retornar a previsão como resposta
    return jsonify({'prediction': prediction.tolist()}), 200

if __name__ == '__main__':
    app.run(debug=True)